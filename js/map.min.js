function ViewModel(){var e=this;e.places=ko.observableArray([]),e.infoWindows=[],e.infoWindow=null,e.searchString=ko.observable(),e.map=null,e.lastPlaceSelected=null,e.lastZ=null,e.placeClicked=function(t){e.lastZ=t.marker.getZIndex(),e.lastPlaceSelected&&(e.lastPlaceSelected.isSelected(!1),e.lastPlaceSelected.marker.setZIndex(e.lastZ)),t.isSelected(!0),t.marker.setZIndex(google.maps.Marker.MAX_ZINDEX+1),e.lastPlaceSelected=t,console.log("IN SELF.PLACECLICKED, calling showInfo for "+t.name),e.showInfo(t)},e.searchString.subscribe(function(t){if(""!==t)for(var o=0;o<e.places().length;o++){for(var s=t.toLowerCase().trim(),a=e.places()[o].name.toLowerCase(),l=a.split(" "),n=!1,r=0;r<l.length;r++)if(l[r].substr(0,s.length)===s||a.substr(0,s.length)===s){console.log("if "+l[r]+" equals "+s),n=!0,e.places()[o].marker.setMap(e.map),e.places()[o].isActive(!0);break}n||(e.infoWindow&&e.infoWindow.close(),e.places()[o].isActive(!1),e.places()[o].marker.setMap(null))}else for(var o=0;o<e.places().length;o++)e.places()[o].marker.setMap(e.map),e.places()[o].isActive(!0),e.places()[o].isSelected(!1)}),e.init=function(){window.onerror=function(){e.showErrorMsg("GENERAL ERROR")},$.ajax({type:"GET",url:"data.min.json",async:!0,dataType:"json",success:function(t){e.createMap();for(var o=0;o<t.places.length;o++){var s=t.places[o];s.isActive=ko.observable(!0),s.isSelected=ko.observable(!1);var a=new google.maps.Marker({position:s.position,name:s.name});a.image=s.image,a.setMap(e.map),a.setZIndex(o),google.maps.event.addListener(a,"click",function(t){return function(){e.placeClicked(t),e.showInfo(t)}}(s)),s.marker=a,e.places.push(s)}},error:function(){e.showErrorMsg("JSON READ ERROR")}})},e.createMap=function(){var t={center:{lat:36.15546,lng:-86.82967},styles:[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-20}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"road.highway",elementType:"labels.icon"},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{lightness:20},{color:"#efe9e4"}]},{featureType:"landscape.man_made",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{hue:"#11ff00"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"poi",elementType:"labels.icon",stylers:[{hue:"#4cff00"},{saturation:58}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-10}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"simplified"}]}],zoom:10,disableDefaultUI:!0,pancontrol:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_CENTER},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}};e.map=new google.maps.Map(document.getElementById("map-canvas"),t),google.maps.event.addDomListener(window,"resize",function(){var t=e.map.getCenter();google.maps.event.trigger(e.map,"resize"),e.map.setCenter(t)})},e.showInfo=function(t){$(".info-window").empty(),$(".info-window-yelp").empty();var o="<div class='info-window'><h3>"+t.name+"</h3><p class='info-window-yelp-rating'></p><img class='info-window-main-img' src='"+t.image+"'><div class='info-window-yelp'>Retrieving Yelp stuff...</div></div>";e.infoWindow||(e.infoWindow=new google.maps.InfoWindow),e.infoWindow.setContent(o),e.infoWindow.open(this.map,t.marker);var s=$(".info-window");e.getYelpInfo(t.yelpId,s)},e.showErrorMsg=function(e){var t="https://www.google.com/search?q=hot+chicken&ie=utf-8&oe=utf-8#q=hot+chicken+nashville",o="<h2>Something ain't right!</h2>";o+="<p>An error occurred while retrieving your hot chicken map.</p>",o+="<p>Check your connection and please try again.</p>",o+="<p>If all else fails, and you've got a serious hankering for hot chicken, try <a href='"+t+"'>searching for hot chicken on Google</a>",$("body").addClass("global-error"),$(".global-error").html(o),console.log(e)},e.getYelpInfo=function(e){var t={myConsumerKey:"b5sbMuBxHo5ZqlIJJtRxJQ",myConsumerSecret:"z3jXptGnGyBQVMconwRbnELfUaw",myAccessToken:"2iDJU47MJqKTOdO-uNXDLrtI_nrU2_pd",myAccessTokenSecret:"3_S71q7_PYycDDZoDXZoQJ2bEd8",myServiceProvider:{signatureMethod:"HMAC-SHA1"}},o="http://api.yelp.com/v2/business/"+e,s={consumerSecret:t.myConsumerSecret,tokenSecret:t.myAccessTokenSecret},a=[];a.push(["callback","yelpCallback"]),a.push(["jsonpCallback","yelpCallback"]),a.push(["oauth_consumer_key",t.myConsumerKey]),a.push(["oauth_consumer_secret",t.myConsumerSecret]),a.push(["oauth_token",t.myAccessToken]),a.push(["oauth_signature_method","HMAC-SHA1"]);var l={action:o,method:"GET",parameters:a};OAuth.setTimestampAndNonce(l),OAuth.SignatureMethod.sign(l,s);var n=OAuth.getParameterMap(l.parameters);n.oauth_signature=OAuth.percentEncode(n.oauth_signature),$.ajax({url:l.action,data:n,cache:!0,dataType:"jsonp",timeout:5e3,error:function(t,o){$(".info-window-yelp").empty(),console.log("IN ERROR: "+o);var s="http://www.yelp.com/biz/"+e,a="Error retrieving yelp data.";a+="<p>Try visiting <a href='"+s+"'>yelp</a> to read more.</p>",$(".info-window-yelp").html(a)},success:function(e){$(".info-window-yelp").empty();for(var t="<p>",o=0;o<e.location.display_address.length;o++)t+=e.location.display_address[o],o<e.location.display_address.length-1&&(t+=", ");t+="<p>"+e.display_phone+"</p>",t+="<hr>",t+="<div class='rating-section'>",t+="<img class='rating-img' src='"+e.rating_img_url+"'>",t+="<p class='rating-text'>"+e.review_count+" reviews on Yelp</div>",t+="<h5 class='clear'>What people are saying about "+e.name+"...</h5>",t+='"'+e.snippet_text+'"',t+="<p><a href='"+e.url+"'>More from Yelp</a>",$(".info-window-yelp").html(t)}})},e.init()}$(document).ready(function(){ko.applyBindings(new ViewModel)});