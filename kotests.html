<!DOCTYPE html>
<html>
<head>
<title>Data Binding with KnockoutJS</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div id="pic">
<img id="current_book" />
</div>
    

<!--
    <select data-bind="options: places, optionsText: 'name',
                       optionsValue: 'id', value: selectedStudio"></select>
    
      <div id="pic">
    <img id="mainPic" />
    </div>  
-->
    <label for="tags">Filter a tag: </label>
<input id="tags" data-bind="textInput: tag"><br/><br/>
Tags Matching:
<ul>
<!-- ko foreach: matchedTags -->
<li data-bind="text: $data"></li>
<!-- /ko -->
</ul>
    
<script type='text/javascript' src='js/jquery-1.11.3.min.js'></script>
<script type='text/javascript' src='js/knockout-3.3.0.js'></script>
<script>
    

var data = {
    places: [
        {
            id: 0,
            name: "Dark Horse Recording",
            position: {
                lat: 35.945964,
                lng: -86.939763
            },
            description: "This is Dark Horse",
            image: "images/oceanway1.jpg"
        },
        {
            id: 1,
            name: "Blackbird Studios",
            position: {
                lat: 36.143311,
                lng: -86.794066
            },
            description: "this is blackbird",
            image: "images/blackbird1.jpg"
        },
        {
            id: 2,
            name: "Sound Kitchen",
            position: {
                lat: 36.117175,
                lng: -86.753357
            },
            description: "This is sound kitchen",
            image: "images/soundkitchen1.jpg"
        },
        {
            id: 3,
            name: "Sixteen Ton Recording Studio",
            position: {
                lat: 36.146329,
                lng: -86.792327
            },
            description: "This is 16 tons",
            image: "images/sixteenton1.jpg"
        }
    ]
}


function ViewModel() {
    var self = this;
    self.matchedTags = ko.observableArray([]);
    self.availableTags = [];
    self.tag = ko.observable();
    self.tag.subscribe(function(value) {
        self.matchedTags.removeAll();
        if (value !== '') {
            for (var i = 0; i < self.availableTags.length; i++) {
                var search_string = value.toLowerCase();
                var full_tag = self.availableTags[i].toLowerCase();
                var tag_array = full_tag.split(" ");
                
                for(var x = 0; x < tag_array.length; x++) {
                    console.log(tag_array[x]);
                    if( (tag_array[x].substr(0, search_string.length) == search_string)  || 
                    (full_tag.substr(0, search_string.length) == search_string) ) {
                        self.matchedTags.push(self.availableTags[i]);
                    }
                }
                    
/*
                if(string2search.substr(0, search_string.length) == search_string) {
                    //console.log("MATCH on " + string2search);
                    self.matchedTags.push(self.availableTags[i]);
                }
                */
                /*
                if (self.availableTags[i].toLowerCase().indexOf(value.toLowerCase()) >= 0)
                    self.matchedTags.push(self.availableTags[i]);
                    */
                }
                
            }
        });
    
    $.ajax({
        url: 'tags.html',
        type: 'GET',
        contentType: 'application/json',
        dataType: 'json'
        }).success(function(data) {
        self.availableTags = data;
       
    });
    /*
    self.places = data.places;
    self.selectedStudio = ko.observable();
    
    self.selectedStudio.subscribe(function() {
        console.log("selectedStudio is now " + self.selectedStudio());
        $("#mainPic").attr("src", self.places[self.selectedStudio()].image);
    });
    */
};
var viewModel = new ViewModel();
ko.applyBindings(viewModel);

    </script>
</body>
</html>